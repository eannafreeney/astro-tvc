---
import { slugify, calcPercentageSold } from '../../utils/common';
import {AddToCartForm, Breadcrumb} from '../Product'

const {shopifyProduct, airtableData} = Astro.props;
const variants = shopifyProduct?.variants.nodes;

  const hasPrint = !!airtableData.print_image;
  const isFunding = airtableData.categories.includes("Funding");

  const firstVariant = shopifyProduct?.variants.nodes[0];
  console.log(firstVariant);
  
  
  const fundingPercentage = Math.round(
    calcPercentageSold(airtableData.edition_size, firstVariant.inventory_quantity)
  );

---
    <section class="mt-4 container">
      <Breadcrumb data={airtableData} />
      <div>
        <div class="font-SohneKraftig">{airtableData.title}</div>
        <ul >
          {airtableData.artist.map((artist) => (
            <a href={`/artists/${artist}`}>
              <li class="">{artist}</li>
            </a>
          ))}
        </ul>
        <!-- <div>{getPrice(categories, price, comparePrice)}</div> -->
      </div>
      <AddToCartForm client:load variants={variants} />
      {
        isFunding && (
  //       <div class="container h-4 w-full bg-[#e0e0de]" completed={fundingPercentage}>
  //   <div class="h-full">
  //     <span class="text-white font-bold">{`${fundingPercentage}% Funded`}</span>
  //   </div>
  // </div>
        <div class="container border border-gray-500 p-4 mb-2 text-gray-500">
    {airtableData.funding}
  </div>
        )
      }
      <div class="hidden md:block">
        <div class="mb-2">{airtableData.description}</div>
        <div class="mb-2">{airtableData.bio}</div>
      </div>
      <ul class="mb-2">
        <li class="text-gray-500 text-sm">
          {airtableData.pages} pages, {airtableData.size}
        </li>
        <li class="text-gray-500 text-sm">{airtableData.format}</li>
        <li class="text-gray-500 text-sm">ISBN {shopifyProduct.ISBN}</li>
        <li class="text-gray-500 text-sm">
          Limited Edition of {airtableData.edition_size}
        </li>
        <li class="text-gray-500 text-sm">{airtableData.SKU}</li>
      </ul>
      <div class="flex flex-wrap gap-1 mb-2">
        {airtableData.tags.map((tag) => (
          <a
            href={`/tag/${slugify(tag)}`}
            class="border border-primary-100 rounded py-1 px-2 text-primary-100"
          >
            # {tag}
          </a>
        ))}
      </div>
      {
        hasPrint && <div>PRINT</div>
      }
    </section>

